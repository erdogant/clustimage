

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mnist dataset &mdash; clustimage clustimage documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=e0179649" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=88d6c118"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Sponsor" href="Documentation.html" />
    <link rel="prev" title="Saving" href="Save%20and%20Load.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            clustimage
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
    
              <p class="caption" role="heading"><span class="caption-text">Background</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Abstract.html">Abstract</a></li>
<li class="toctree-l1"><a class="reference internal" href="Abstract.html#schematic-overview">Schematic overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Installation.html#uninstalling">Uninstalling</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Core functionalities</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html">Core functionalities</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#preprocessing">Preprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#output">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#generic-functions">Generic functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#merge-expand-clusters">Merge/ Expand Clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#move-files-based-on-clusterlabels">Move files based on clusterlabels</a></li>
<li class="toctree-l1"><a class="reference internal" href="core_functions.html#plotting">Plotting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Feature Extraction</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Feature%20Extraction.html">PCA</a></li>
<li class="toctree-l1"><a class="reference internal" href="Feature%20Extraction.html#hog">HOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="Feature%20Extraction.html#exif">EXIF</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Cluster Evaluation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Cluster%20Evaluation.html">Gridsearch</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cluster%20Evaluation.html#silhouette">Silhouette</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cluster%20Evaluation.html#dbindex">DBindex</a></li>
<li class="toctree-l1"><a class="reference internal" href="Cluster%20Evaluation.html#dbscan">DBSCAN</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Find/Predict</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Find.html">k-nearest neighbour</a></li>
<li class="toctree-l1"><a class="reference internal" href="Find.html#probability-density-fitting">Probability density fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="Find.html#more-examples">More examples</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Performance</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Performance.html">Performance</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Save and Load</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Save%20and%20Load.html">Saving</a></li>
<li class="toctree-l1"><a class="reference internal" href="Save%20and%20Load.html#loading">Loading</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Mnist dataset</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#load-dataset">Load dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-the-images">Cluster the images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#detect-unique-images">Detect unique images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#cluster-evaluation">Cluster evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#scatter-plot">Scatter plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-images-detected-in-a-cluster">Plot images detected in a cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#dendrogram">Dendrogram</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#caltech101-dataset">Caltech101 dataset</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id1">Cluster the images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id2">Cluster evaluation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#silhouette-plot">Silhouette Plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#average-image-per-cluster">Average image per cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id3">Scatter plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#plot-images-detected-in-a-particular-cluster">Plot images detected in a particular cluster</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#flower-dataset">Flower dataset</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#id4">Load dataset</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id5">Cluster the images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id6">Detect unique images</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id7">Scatter plot</a></li>
<li class="toctree-l2"><a class="reference internal" href="#id8">Plot images detected in a particular cluster</a></li>
<li class="toctree-l2"><a class="reference internal" href="#predict-unseen-sample">Predict unseen sample</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="#clustering-of-faces">Clustering of faces</a></li>
<li class="toctree-l1"><a class="reference internal" href="#extract-images-belonging-to-clusters">Extract images belonging to clusters</a></li>
<li class="toctree-l1"><a class="reference internal" href="#set-image-filenames-using-pandas-dataframes">Set image filenames using pandas dataframes</a></li>
<li class="toctree-l1"><a class="reference internal" href="#module-clustimage.clustimage.url2disk">Import images from url location</a></li>
<li class="toctree-l1"><a class="reference internal" href="#breaking-up-the-steps">Breaking up the steps</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html">Sponsor</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html#blog">Blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html#github">Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html#colab-notebook">Colab Notebook</a></li>
<li class="toctree-l1"><a class="reference internal" href="Documentation.html#citing">Citing</a></li>
<li class="toctree-l1"><a class="reference internal" href="Coding%20quality.html">Coding quality</a></li>
<li class="toctree-l1"><a class="reference internal" href="clustimage.clustimage.html">API References</a></li>
</ul>

    <a href= "genindex.html">Index</a>
  
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">clustimage</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Mnist dataset</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/Examples.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="mnist-dataset">
<h1>Mnist dataset<a class="headerlink" href="#mnist-dataset" title="Link to this heading"></a></h1>
<p>In this example we will load the mnist dataset and cluster the images.</p>
<section id="load-dataset">
<h2>Load dataset<a class="headerlink" href="#load-dataset" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load library</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>
<span class="c1"># init</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">()</span>
<span class="c1"># Load example digit data</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;mnist&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
<span class="c1"># Each row is an image that can be plotted after reshaping:</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
<span class="c1"># array([[ 0.,  0.,  5., ...,  0.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  0., ..., 10.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  0., ..., 16.,  9.,  0.],</span>
<span class="c1">#        ...,</span>
<span class="c1">#        [ 0.,  0.,  0., ...,  9.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  0., ...,  4.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  6., ...,  6.,  0.,  0.]])</span>
<span class="c1">#</span>
</pre></div>
</div>
</section>
<section id="cluster-the-images">
<h2>Cluster the images<a class="headerlink" href="#cluster-the-images" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preprocessing and feature extraction</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Lets examine the results.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="c1"># [&#39;feat&#39;, &#39;xycoord&#39;, &#39;pathnames&#39;, &#39;filenames&#39;, &#39;labels&#39;]</span>
<span class="c1">#</span>
<span class="c1"># feat      : Extracted features</span>
<span class="c1"># xycoord   : Coordinates of samples in the embedded space.</span>
<span class="c1"># filenames : Name of the files</span>
<span class="c1"># pathnames : Absolute location of the files</span>
<span class="c1"># labels    : Cluster labels in the same order as the input</span>
</pre></div>
</div>
</section>
<section id="detect-unique-images">
<h2>Detect unique images<a class="headerlink" href="#detect-unique-images" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the unique images</span>
<span class="n">unique_samples</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
<span class="c1">#</span>
<span class="nb">print</span><span class="p">(</span><span class="n">unique_samples</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># [&#39;labels&#39;, &#39;idx&#39;, &#39;xycoord_center&#39;, &#39;pathnames&#39;]</span>
<span class="c1">#</span>
<span class="c1"># Collect the unique images from the input</span>
<span class="n">X</span><span class="p">[</span><span class="n">unique_samples</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">],:]</span>

<span class="c1"># Plot unique images.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id9">
<caption><span class="caption-text">Plot the unique images per cluster</span><a class="headerlink" href="#id9" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM10" src="_images/digits_unique.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="cluster-evaluation">
<h2>Cluster evaluation<a class="headerlink" href="#cluster-evaluation" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the explained variance</span>
<span class="n">cl</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Make scatter plot of PC1 vs PC2</span>
<span class="n">cl</span><span class="o">.</span><span class="n">pca</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="c1"># Plot the evaluation of the number of clusters</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id10">
<caption><span class="caption-text">Explained variance and Sillhouette score</span><a class="headerlink" href="#id10" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM7" src="_images/digits_explained_var.png" /></p></td>
<td><p><img alt="figM8" src="_images/digits_clusters.png" /></p></td>
</tr>
</tbody>
</table>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make silhouette plot</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;xycoord&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils align-center" id="id11">
<caption><span class="caption-text">Sillhouette analysis results in 9 clusters.</span><a class="headerlink" href="#id11" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM9" src="_images/digits_fig1.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="scatter-plot">
<h2>Scatter plot<a class="headerlink" href="#scatter-plot" title="Link to this heading"></a></h2>
<p>The scatterplot that is coloured on the clusterlabels. The clusterlabels should match the unique labels.
Cluster 1 contains digit 4, and  Cluster 5 contains digit 2, etc.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make scatterplot</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Plot the image that is in the center of the cluster</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Lets change some more arguments to make a pretty scatterplot</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dotsize</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">25</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">args_scatter</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fontsize&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span> <span class="s1">&#39;gradient&#39;</span><span class="p">:</span><span class="s1">&#39;#FFFFFF&#39;</span><span class="p">,</span> <span class="s1">&#39;cmap&#39;</span><span class="p">:</span><span class="s1">&#39;Set2&#39;</span><span class="p">,</span> <span class="s1">&#39;legend&#39;</span><span class="p">:</span><span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
<table class="docutils align-center" id="id12">
<caption><span class="caption-text">Left: Scatter plot with cluster labels of all samples. Right: scatter plot with unique image in center.</span><a class="headerlink" href="#id12" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM1" src="_images/digits_fig2_tsne.png" /></p></td>
<td><p><img alt="figM2" src="_images/digits_fig21_tsne.png" /></p></td>
</tr>
<tr class="row-even"><td colspan="2"><p><img alt="figM12" src="_images/digits_fig22_tsne.png" /></p></td>
</tr>
</tbody>
</table>
<p>High resolution images where all mnist samples are shown.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">plt_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils align-center" id="id13">
<caption><span class="caption-text">Left: Scatter plot with cluster labels of all samples. Right: scatter plot with unique image in center.</span><a class="headerlink" href="#id13" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM3" src="_images/scatter_mnist_all.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="plot-images-detected-in-a-cluster">
<h2>Plot images detected in a cluster<a class="headerlink" href="#plot-images-detected-in-a-cluster" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot all images per cluster</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>

<span class="c1"># Plot the images in a specific cluster</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils align-center" id="id14">
<caption><span class="caption-text">Images that are detected in a particular cluster.</span><a class="headerlink" href="#id14" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM4" src="_images/digits_cluster1.png" /></p></td>
<td><p><img alt="figM5" src="_images/digits_cluster5.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="dendrogram">
<h2>Dendrogram<a class="headerlink" href="#dendrogram" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># The dendrogram is based on the high-dimensional feature space.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id15">
<caption><span class="caption-text">Dendrogram of the mnist dataset</span><a class="headerlink" href="#id15" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figM6" src="_images/digits_dendrogram.png" /></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="caltech101-dataset">
<h1>Caltech101 dataset<a class="headerlink" href="#caltech101-dataset" title="Link to this heading"></a></h1>
<p>The documentation and docstrings readily contains various examples but lets make another one with many samples.
In this example, the <strong>Caltech101</strong> dataset will be clustered!
The pictures of objects belonging to 101 categories. About 40 to 800 images per category. Most categories have about 50 images. The size of each image is roughly 300 x 200 pixels.
Download the dataset over here: <a class="reference external" href="http://www.vision.caltech.edu/Image_Datasets/Caltech101/#Download">http://www.vision.caltech.edu/Image_Datasets/Caltech101/#Download</a></p>
<section id="id1">
<h2>Cluster the images<a class="headerlink" href="#id1" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>

<span class="c1"># init</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">params_pca</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;n_components&#39;</span><span class="p">:</span><span class="mi">250</span><span class="p">})</span>

<span class="c1"># Collect samples</span>
<span class="c1"># Preprocessing, feature extraction and cluster evaluation</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="s1">&#39;C://101_ObjectCategories//&#39;</span><span class="p">,</span> <span class="n">min_clust</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">max_clust</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># Try some other clustering (evaluation) approaches</span>
<span class="c1"># cl.cluster(evaluate=&#39;silhouette&#39;, min_clust=30, max_clust=60)</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>Cluster evaluation<a class="headerlink" href="#id2" title="Link to this heading"></a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">clustimage</span></code> we extracted the features that explained 89% of the variance. The optimal number of clusters of 49 (right figure).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Evaluate the number of clusters.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;xycoord&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils align-center" id="id16">
<caption><span class="caption-text">Left: Percentage explained variance. Right: Optimal number of clusters.</span><a class="headerlink" href="#id16" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figE1" src="_images/101_explainedvar.png" /></p></td>
<td><p><img alt="figE2" src="_images/101_optimalclusters.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="silhouette-plot">
<h2>Silhouette Plot<a class="headerlink" href="#silhouette-plot" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot one of the clusters</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="mi">40</span><span class="p">)</span>

<span class="c1"># Plotting</span>
<span class="n">cl</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id17">
<caption><span class="caption-text">Silhouette plot</span><a class="headerlink" href="#id17" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figE30" src="_images/101_silhouette_plot.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="average-image-per-cluster">
<h2>Average image per cluster<a class="headerlink" href="#average-image-per-cluster" title="Link to this heading"></a></h2>
<p>For each of the detected clusters, we can collect the images and plot the image in the center (left figure), or we can average all images to a single image (right figure).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot unique images.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">(</span><span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-center" id="id18">
<caption><span class="caption-text">Left: Unique images gathered from the center of the cluster. Right: Averaged image of the cluster.</span><a class="headerlink" href="#id18" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figE8" src="_images/unique_mean_101.png" /></p></td>
<td><p><img alt="figE9" src="_images/unique_mean_101.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id3">
<h2>Scatter plot<a class="headerlink" href="#id3" title="Link to this heading"></a></h2>
<p>A scatter plot demonstrates the samples with its cluster labels (colors), and the average images per cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scatter</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-center" id="id19">
<caption><span class="caption-text">Left: Unique images gathered from the center of the cluster. Right: Averaged image of the cluster.</span><a class="headerlink" href="#id19" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figE4" src="_images/101_tsne_no_mean.png" /></p></td>
<td><p><img alt="figE5" src="_images/101_tsne.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="plot-images-detected-in-a-particular-cluster">
<h2>Plot images detected in a particular cluster<a class="headerlink" href="#plot-images-detected-in-a-particular-cluster" title="Link to this heading"></a></h2>
<table class="docutils align-center" id="id20">
<caption><span class="caption-text">Two examples of the clusters that are detected.</span><a class="headerlink" href="#id20" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figE6" src="_images/101_cluster40.png" /></p></td>
<td><p><img alt="figE7" src="_images/101_cluster.png" /></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="flower-dataset">
<h1>Flower dataset<a class="headerlink" href="#flower-dataset" title="Link to this heading"></a></h1>
<p>In this example we will load the flower dataset and cluster the images for which the path locations are on disk.</p>
<section id="id4">
<h2>Load dataset<a class="headerlink" href="#id4" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load library</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>

<span class="c1"># init</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span>

<span class="c1"># load example with flowers</span>
<span class="n">pathnames</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;flowers&#39;</span><span class="p">)</span>

<span class="c1"># The pathnames are stored in a list</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pathnames</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span>
<span class="c1"># [&#39;C:\\temp\\flower_images\\0001.png&#39;, &#39;C:\\temp\\flower_images\\0002.png&#39;]</span>
</pre></div>
</div>
</section>
<section id="id5">
<h2>Cluster the images<a class="headerlink" href="#id5" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Preprocessing, feature extraction and clustering.</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pathnames</span><span class="p">)</span>
</pre></div>
</div>
<p>The number of detected clusters looks pretty good because there is a high distinction between the peak for 5 clusters and the number of clusters that subsequently follow.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;xycoord&#39;</span><span class="p">])</span>
</pre></div>
</div>
<table class="docutils align-center" id="id21">
<caption><span class="caption-text">Sillhouette score vs. number of clusters</span><a class="headerlink" href="#id21" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figF1" src="_images/flowers_sil_vs_nrclusters.png" /></p></td>
<td><p><img alt="figF2" src="_images/flowers_silhouette.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id6">
<h2>Detect unique images<a class="headerlink" href="#id6" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot unique images</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">(</span><span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Plot all images per cluster</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id22">
<caption><span class="caption-text">Unique images per cluster</span><a class="headerlink" href="#id22" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figF3" src="_images/flowers_unique.png" /></p></td>
<td><p><img alt="figF4" src="_images/flowers_unique_mean.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id7">
<h2>Scatter plot<a class="headerlink" href="#id7" title="Link to this heading"></a></h2>
<p>A scatter plot demonstrates the samples with its cluster labels (colors), and the average images per cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scatter</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">dotsize</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">zoom</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">img_mean</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="mf">1.2</span><span class="p">,</span> <span class="n">plt_all</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">100</span><span class="p">))</span>
</pre></div>
</div>
<table class="docutils align-center" id="id23">
<caption><span class="caption-text">Scatterplots</span><a class="headerlink" href="#id23" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figF6" src="_images/flowers_scatter.png" /></p></td>
<td><p><img alt="figF7" src="_images/flowers_scatter_imgs_mean.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figF8" src="_images/flowers_scatter_imgs.png" /></p></td>
<td><p><img alt="figF9" src="_images/flowers_predict_scatter_all.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="id8">
<h2>Plot images detected in a particular cluster<a class="headerlink" href="#id8" title="Link to this heading"></a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the images in a specific cluster</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
<table class="docutils align-center" id="id24">
<caption><span class="caption-text">Images in various clusters</span><a class="headerlink" href="#id24" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figF5" src="_images/flowers_cluster3.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figF10" src="_images/flowers_plot1.png" /></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="figF11" src="_images/flowers_plot2.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figF12" src="_images/flowers_cluster3.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="predict-unseen-sample">
<h2>Predict unseen sample<a class="headerlink" href="#predict-unseen-sample" title="Link to this heading"></a></h2>
<p>Find images that are significanly similar as the unseen input image.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">results_find</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">path_to_imgs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_find</span><span class="p">()</span>

<span class="c1"># Map the unseen images in existing feature-space.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id25">
<caption><span class="caption-text">Finding similar images as input image.</span><a class="headerlink" href="#id25" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figF13" src="_images/flowers_predict_1.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figF14" src="_images/flowers_predict_2.png" /></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="figF15" src="_images/flowers_predict_scatter.png" /></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="clustering-of-faces">
<h1>Clustering of faces<a class="headerlink" href="#clustering-of-faces" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>
<span class="c1"># Initialize with PCA</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">,</span> <span class="n">grayscale</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Load example with faces</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;faces&#39;</span><span class="p">)</span>
<span class="c1"># Initialize and run</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># In case you need to extract the faces from the images</span>
<span class="c1"># face_results = cl.extract_faces(pathnames)</span>
<span class="c1"># The detected faces are extracted and stored in face_resuls. We can now easily provide the pathnames of the faces that are stored in pathnames_face.</span>
<span class="c1"># results = cl.fit_transform(face_results[&#39;pathnames_face&#39;])</span>

<span class="c1"># Plot the evaluation of the number of clusters. As you can see, the maximum number of cluster evaluated is 24 can perhaps be too small.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="c1"># Lets increase the maximum number and clusters and run solely the clustering. Note that you do not need to fit_transform() anymore. You can only do the clustering now.</span>
<span class="n">cl</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">max_clust</span><span class="o">=</span><span class="mi">35</span><span class="p">)</span>
<span class="c1"># And plot again. As you can see, it keeps increasing which means that it may not found any local maximum anymore.</span>
<span class="c1"># When looking at the graph, we see a local maximum at 12 clusters. Lets go for that</span>
<span class="n">cl</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">min_clust</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">max_clust</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="c1"># Lets plot the 12 unique clusters that contain the faces</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">()</span>

<span class="c1"># Scatter</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">zoom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="c1"># Make plot</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">show_hog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">])</span>

<span class="c1"># Plot faces</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_faces</span><span class="p">()</span>
<span class="c1"># Dendrogram depicts the clustering of the faces</span>
<span class="n">cl</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">()</span>
</pre></div>
</div>
<table class="docutils align-center" id="id26">
<caption><span class="caption-text">Scatterplots</span><a class="headerlink" href="#id26" title="Link to this table"></a></caption>
<tbody>
<tr class="row-odd"><td><p><img alt="figG1" src="_images/faces_sil_vs_nrclusters.png" /></p></td>
<td><p><img alt="figG2" src="_images/faces_set_max_clust.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figG3" src="_images/faces_unique.png" /></p></td>
<td><p><img alt="figG4" src="_images/faces_scatter_no_img.png" /></p></td>
</tr>
<tr class="row-odd"><td><p><img alt="figG5" src="_images/faces_scatter.png" /></p></td>
<td><p><img alt="figG6" src="_images/faces_cluster0.png" /></p></td>
</tr>
<tr class="row-even"><td><p><img alt="figG7" src="_images/faces_cluster3.png" /></p></td>
<td><p><img alt="figG8" src="_images/faces1.png" /></p></td>
</tr>
</tbody>
</table>
</section>
<section id="extract-images-belonging-to-clusters">
<h1>Extract images belonging to clusters<a class="headerlink" href="#extract-images-belonging-to-clusters" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import library</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>
<span class="c1"># Initialize</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span>
<span class="c1"># Import data</span>
<span class="n">pathnames</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;flowers&#39;</span><span class="p">)</span>
<span class="c1"># Cluster flowers</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">pathnames</span><span class="p">)</span>

<span class="c1"># All results are stored in a dict:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="c1"># Which is the same as:</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>

<span class="n">dict_keys</span><span class="p">([</span><span class="s1">&#39;img&#39;</span><span class="p">,</span> <span class="s1">&#39;feat&#39;</span><span class="p">,</span> <span class="s1">&#39;xycoord&#39;</span><span class="p">,</span> <span class="s1">&#39;pathnames&#39;</span><span class="p">,</span> <span class="s1">&#39;labels&#39;</span><span class="p">,</span> <span class="s1">&#39;filenames&#39;</span><span class="p">])</span>

<span class="c1"># Extracting images that belong to cluster label=0:</span>
<span class="n">Iloc</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span>
<span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;pathnames&#39;</span><span class="p">][</span><span class="n">Iloc</span><span class="p">]</span>

<span class="c1"># Extracting xy-coordinates for the scatterplot for cluster 0:</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">xycoord</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;xycoord&#39;</span><span class="p">][</span><span class="n">Iloc</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xycoord</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">xycoord</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># Plot the images for cluster 0:</span>
<span class="c1"># Images in cluster 0</span>
<span class="n">imgs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">][</span><span class="n">Iloc</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Make sure you get the right dimension</span>
<span class="n">dim</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">get_dim</span><span class="p">(</span><span class="n">cl</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;img&#39;</span><span class="p">][</span><span class="n">Iloc</span><span class="p">][</span><span class="mi">0</span><span class="p">,:])</span>
<span class="c1"># Plot</span>
<span class="k">for</span> <span class="n">img</span> <span class="ow">in</span> <span class="n">imgs</span><span class="p">:</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">dim</span><span class="p">))</span>
  <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="set-image-filenames-using-pandas-dataframes">
<h1>Set image filenames using pandas dataframes<a class="headerlink" href="#set-image-filenames-using-pandas-dataframes" title="Link to this heading"></a></h1>
<p>In case a datamatrix is provided as an input to the model, the default setting is that random filenames are generated and stored in the tempdirectory. However, with a pandas dataframe as input you can provide the desired filenames by changing the index names!</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># Initialize</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">()</span>

<span class="c1"># Import data</span>
<span class="n">Xraw</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;mnist&#39;</span><span class="p">)</span>

<span class="c1"># The Xraw datamatrix is numpy array for which the rows are the different images.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Xraw</span><span class="p">)</span>
<span class="c1"># array([[ 0.,  0.,  5., ...,  0.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  0., ..., 10.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  0., ..., 16.,  9.,  0.],</span>
<span class="c1">#        ...,</span>
<span class="c1">#        [ 0.,  0.,  1., ...,  6.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0.,  2., ..., 12.,  0.,  0.],</span>
<span class="c1">#        [ 0.,  0., 10., ..., 12.,  1.,  0.]])</span>

<span class="c1"># Create some filenames</span>
<span class="n">filenames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Xraw</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])))</span>
<span class="c1"># Store in a pandas dataframe</span>
<span class="n">Xraw</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">Xraw</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">filenames</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">Xraw</span><span class="p">)</span>
<span class="c1">#            0    1     2     3     4     5   ...   58    59    60    61   62   63</span>
<span class="c1"># 0.png     0.0  0.0   5.0  13.0   9.0   1.0  ...  6.0  13.0  10.0   0.0  0.0  0.0</span>
<span class="c1"># 1.png     0.0  0.0   0.0  12.0  13.0   5.0  ...  0.0  11.0  16.0  10.0  0.0  0.0</span>
<span class="c1"># 2.png     0.0  0.0   0.0   4.0  15.0  12.0  ...  0.0   3.0  11.0  16.0  9.0  0.0</span>
<span class="c1"># 3.png     0.0  0.0   7.0  15.0  13.0   1.0  ...  7.0  13.0  13.0   9.0  0.0  0.0</span>
<span class="c1"># 4.png     0.0  0.0   0.0   1.0  11.0   0.0  ...  0.0   2.0  16.0   4.0  0.0  0.0</span>
<span class="c1">#       ...  ...   ...   ...   ...   ...  ...  ...   ...   ...   ...  ...  ...</span>
<span class="c1"># 1792.png  0.0  0.0   4.0  10.0  13.0   6.0  ...  2.0  14.0  15.0   9.0  0.0  0.0</span>
<span class="c1"># 1793.png  0.0  0.0   6.0  16.0  13.0  11.0  ...  6.0  16.0  14.0   6.0  0.0  0.0</span>
<span class="c1"># 1794.png  0.0  0.0   1.0  11.0  15.0   1.0  ...  2.0   9.0  13.0   6.0  0.0  0.0</span>
<span class="c1"># 1795.png  0.0  0.0   2.0  10.0   7.0   0.0  ...  5.0  12.0  16.0  12.0  0.0  0.0</span>
<span class="c1"># 1796.png  0.0  0.0  10.0  14.0   8.0   1.0  ...  8.0  12.0  14.0  12.0  1.0  0.0</span>

<span class="c1"># Fit and transform the data</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">Xraw</span><span class="p">)</span>

<span class="c1"># The index filenames are now used to store the images on disk.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="s1">&#39;filenames&#39;</span><span class="p">])</span>
<span class="c1"># array([&#39;0.png&#39;, &#39;1.png&#39;, &#39;2.png&#39;, ..., &#39;1794.png&#39;, &#39;1795.png&#39;, &#39;1796.png&#39;],</span>
</pre></div>
</div>
</section>
<section id="module-clustimage.clustimage.url2disk">
<span id="import-images-from-url-location"></span><h1>Import images from url location<a class="headerlink" href="#module-clustimage.clustimage.url2disk" title="Link to this heading"></a></h1>
<p>Write url locations to disk.</p>
<p>Images can also be imported from url locations.
Each image is first downloaded and stored on a (specified) temp directory.
In this example we will download 5 images from url locations. Note that url images and path locations can be combined.</p>
<dl class="field-list simple">
<dt class="field-odd">param urls<span class="colon">:</span></dt>
<dd class="field-odd"><p>list of url locations with image path.</p>
</dd>
<dt class="field-even">type urls<span class="colon">:</span></dt>
<dd class="field-even"><p>list</p>
</dd>
<dt class="field-odd">param save_dir<span class="colon">:</span></dt>
<dd class="field-odd"><p>location to disk.</p>
</dd>
<dt class="field-even">type save_dir<span class="colon">:</span></dt>
<dd class="field-even"><p>str</p>
</dd>
<dt class="field-odd">returns<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>urls</strong> – list to url locations that are now stored on disk.</p>
</dd>
<dt class="field-even">rtype<span class="colon">:</span></dt>
<dd class="field-even"><p>list of str.</p>
</dd>
</dl>
<p class="rubric">Examples</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Init with default settings</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">cl</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Importing the files files from disk, cleaning and pre-processing</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">url_to_images</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;https://erdogant.github.io/datasets/images/flower_images/flower_orange.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;https://erdogant.github.io/datasets/images/flower_images/flower_white_1.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;https://erdogant.github.io/datasets/images/flower_images/flower_white_2.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;https://erdogant.github.io/datasets/images/flower_images/flower_yellow_1.png&#39;</span><span class="p">,</span>
<span class="gp">&gt;&gt;&gt; </span>                 <span class="s1">&#39;https://erdogant.github.io/datasets/images/flower_images/flower_yellow_2.png&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Import into model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">url2disk</span><span class="p">(</span><span class="n">url_to_images</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;c:/temp/out/&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
</pre></div>
</div>
</section>
<section id="breaking-up-the-steps">
<h1>Breaking up the steps<a class="headerlink" href="#breaking-up-the-steps" title="Link to this heading"></a></h1>
<p>Instead of using the all-in-one functionality: fit_transform(), it is also possible to break-up the steps.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">clustimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">Clustimage</span>

<span class="c1"># Initialize</span>
<span class="n">cl</span> <span class="o">=</span> <span class="n">Clustimage</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pca&#39;</span><span class="p">)</span>

<span class="c1"># Import data</span>
<span class="n">Xraw</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;flowers&#39;</span><span class="p">)</span>
<span class="n">Xraw</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;mnist&#39;</span><span class="p">)</span>
<span class="n">Xraw</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_example</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="s1">&#39;faces&#39;</span><span class="p">)</span>

<span class="c1"># Check whether in is dir, list of files or array-like</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">import_data</span><span class="p">(</span><span class="n">Xraw</span><span class="p">)</span>

<span class="c1"># Extract features using method</span>
<span class="n">Xfeat</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">extract_feat</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Embedding using tSNE</span>
<span class="n">xycoord</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">Xfeat</span><span class="p">)</span>

<span class="c1"># Cluster</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span>

<span class="c1"># Return</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">results</span>

<span class="c1"># Or all in one run</span>
<span class="c1"># results = cl.fit_transform(X)</span>

<span class="c1"># Plots</span>
<span class="n">cl</span><span class="o">.</span><span class="n">clusteval</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">scatter</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_unique</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">cl</span><span class="o">.</span><span class="n">dendrogram</span><span class="p">()</span>

<span class="c1"># Find</span>
<span class="n">results_find</span> <span class="o">=</span> <span class="n">cl</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Xraw</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
<span class="n">cl</span><span class="o">.</span><span class="n">plot_find</span><span class="p">()</span>
</pre></div>
</div>
<hr>
<center>
        <script async src="https://media.ethicalads.io/media/client/ethicalads.min.js"></script>
        <!-- Show an image ad -->
        <!-- <div data-ea-publisher="erdogantgithubio" data-ea-type="image"></div> -->
        <div data-ea-publisher="erdogantgithubio" data-ea-type="image" data-ea-style="stickybox"></div>
</center>
<hr></section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="Save%20and%20Load.html" class="btn btn-neutral float-left" title="Saving" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="Documentation.html" class="btn btn-neutral float-right" title="Sponsor" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, Erdogan Taskesen.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>